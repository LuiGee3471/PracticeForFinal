<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Insert title here</title>
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.3.0/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
  </head>
  <body>
    <div th:object="${board}">
      <h1 th:text="${board.title}"></h1>
      <p>글쓴이: <span th:text="${board.writer}" id="writer"></span></p>
      <p th:text="${board.content}"></p>
    </div>

    <form method="post" th:object="${user}">
      <input type="hidden" th:value="${user.id}" id="comment-writer" />
      <input type="hidden" name="boardId" id="boardId" th:value="${board.id}" />
      <input type="text" name="content" id="content" />
      <button type="submit" id="submit">댓글 달기</button>
    </form>
    <table>
      <tr>
        <th>글쓴이</th>
        <th>내용</th>
      </tr>
      <tr th:each="comment : ${commentList}">
        <td th:text="${comment.writer}"></td>
        <td th:text="${comment.content}"></td>
      </tr>
    </table>

    <script>
      var sock = new SockJS("/sample");
      var client = Stomp.over(sock);

      var submit = document.getElementById("submit");

      submit.addEventListener("click", function(event) {
        var writer = document.getElementById("writer").innerText;
        client.send(
          "/topic/noti/" + writer,
          {},
          JSON.stringify({
            writer: document.getElementById("comment-writer").value,
            content: document.getElementById("content").value,
            boardWriter: writer
          })
        );
      });
    </script>
  </body>
</html>
